# π“ Coffee Order System - Tech Spec

## ν”„λ΅μ νΈ μ”μ•½ (Summary)

μ»¤ν”Όμ μ£Όλ¬Έ μ‹μ¤ν…μ„ μ„¤κ³„ λ° κµ¬ν„ν•λ‹¤. μ‚¬μ©μλ” λ©”λ‰΄λ¥Ό μ΅°νν•κ³ , ν¬μΈνΈλ¥Ό μ¶©μ „ν• λ’¤ μ»¤ν”Όλ¥Ό μ£Όλ¬Έν•  μ μμΌλ©°, μµκ·Ό μΈκΈ° μλ” μ»¤ν”Όλ¥Ό μ΅°νν•  μ μλ‹¤. λ¨λ“  κΈ°λ¥μ€ ν™•μ¥μ„±κ³Ό λ°μ΄ν„° μΌκ΄€μ„±μ„ κ³ λ ¤ν•μ—¬ μ„¤κ³„λλ‹¤.

---

## λ©ν‘ (Goals)

- μ»¤ν”Ό λ©”λ‰΄ μ΅°ν, ν¬μΈνΈ μ¶©μ „, μ»¤ν”Ό μ£Όλ¬Έ λ° μΈκΈ° λ©”λ‰΄ μ΅°ν API κµ¬ν„
- λ‹¤μ¤‘ μ„λ²„ ν™κ²½μ—μ„λ„ μ •ν™•ν•κ² λ™μ‘ν•λ” μ£Όλ¬Έ ν†µκ³„ μ‹μ¤ν… κµ¬μ¶•
- λ™μ‹μ„± λ° λ°μ΄ν„° μ •ν•©μ„± μ΄μμ— λ€ν• κ²¬κ³ ν• μ„¤κ³„
- μ λ‹› λ° ν†µν•© ν…μ¤νΈλ¥Ό ν†µν• μ•μ •μ„± ν™•λ³΄

---

## κ³„ν (Plan)

### 1. μ‹μ¤ν… κµ¬μ„±λ„

```mermaid
graph TD
    User --> API[API Server]
    API --> MS[Menu Service]
    API --> PS[Point Service]
    API --> OS[Order Service]
    OS
    MS --> DB[(RDBMS)]
    PS --> DB[(RDBMS)]
    OS --> DB[(RDBMS)]
```

---

### 2. λ„λ©”μΈ λ¨λΈ (Entity Relationship Diagram)

```mermaid
erDiagram
    USER ||--o{ ORDER : places
    USER ||--o{ POINT_TRANSACTION : creates
    ORDER ||--o{ ORDER_ITEM : has
    MENU ||--o{ ORDER_ITEM : included_in

    USER {
        UUID id PK
        string name
        int point
    }

    POINT_TRANSACTION {
        UUID id PK
        UUID user_id FK "user.id"
        int amount
        enum type "ADD, DEDUCT"
        datetime created_at
    }

    MENU {
        UUID id PK
        string name
        int price
    }

    ORDER {
        UUID id PK
        UUID user_id FK "user.id"
        int total_price
        datetime created_at
    }

    ORDER_ITEM {
      UUID id PK
      UUID order_id FK "order.id"
      UUID menu_id FK "menu.id"
      int quantity
      int unit_price
      int total_price
    }
```

---

### 3. API λ…μ„Έ

| API μ΄λ¦„       | κ²½λ΅                            | λ©”μ„λ“ | μ„¤λ…                                                      |
| -------------- | ------------------------------- | ------ | --------------------------------------------------------- |
| μ»¤ν”Ό λ©”λ‰΄ μ΅°ν | `/menus`                        | GET    | λ©”λ‰΄ ID, μ΄λ¦„, κ°€κ²© μ΅°ν                                  |
| μΈκΈ° λ©”λ‰΄ μ΅°ν | `/menus/popular`                | GET    | μµκ·Ό 7μΌ μ£Όλ¬Έλ‰ κΈ°μ¤€ Top 3 μ΅°ν                           |
| μ»¤ν”Ό μ£Όλ¬Έ/κ²°μ  | `/orders`                       | POST   | μ£Όλ¬Έ λ° κ²°μ  μ²λ¦¬                                         |
| ν¬μΈνΈ μ¶©μ „    | `/users/{userId}/points/charge` | POST   | ν¬μΈνΈ μ¶©μ „ μ”μ²­ (μ¶©μ „ μλ―Έ μ „λ‹¬ λ•λ¬Έμ— λ™μ‚¬ charge μ‚¬μ©) |

1. GET /menu
   - μ»¤ν”Ό μ •λ³΄(λ©”λ‰΄ID, μ΄λ¦„, κ°€κ²©)μ„ μ΅°νν•λ” APIλ¥Ό μ‘μ„±ν•©λ‹λ‹¤.
2. GET /menu/popular
   - κ²°μ λ” ν¬μΈνΈλ΅λ§ κ°€λ¥ν•λ©°, ν¬μΈνΈλ¥Ό μ¶©μ „ν•λ” APIλ¥Ό μ‘μ„±ν•©λ‹λ‹¤.
   - μ‚¬μ©μ μ‹λ³„κ°’, μ¶©μ „κΈμ•΅μ„ μ…λ ¥ λ°›μ•„ ν¬μΈνΈλ¥Ό μ¶©μ „ν•©λ‹λ‹¤. (1μ›=1P)
3. POST /orders
   - μµκ·Ό 7μΌκ°„ μΈκΈ°μλ” λ©”λ‰΄ 3κ°λ¥Ό μ΅°νν•λ” API μ‘μ„±ν•©λ‹λ‹¤.
   - λ©”λ‰΄λ³„ μ£Όλ¬Έ νμκ°€ μ •ν™•ν•΄μ•Ό ν•©λ‹λ‹¤.
4. POST /user/{user_id}/points/charge
   - μ‚¬μ©μ μ‹λ³„κ°’, λ©”λ‰΄IDλ¥Ό μ…λ ¥ λ°›μ•„ μ£Όλ¬Έμ„ ν•κ³  κ²°μ λ¥Ό μ§„ν–‰ν•©λ‹λ‹¤.
   - κ²°μ λ” ν¬μΈνΈλ΅λ§ κ°€λ¥ν•λ©°, μ¶©μ „ν• ν¬μΈνΈμ—μ„ μ£Όλ¬ΈκΈμ•΅μ„ μ°¨κ°ν•©λ‹λ‹¤.
   - μ£Όλ¬Έ λ‚΄μ—­μ„ λ°μ΄ν„° μμ§‘ ν”λ«νΌμΌλ΅ μ‹¤μ‹κ°„ μ „μ†΅ν•λ” λ΅μ§μ„ μ¶”κ°€ν•©λ‹λ‹¤.
     (Mock API λ“±μ„ μ‚¬μ©ν•μ—¬ μ‚¬μ©μ μ‹λ³„κ°’, λ©”λ‰΄ID, κ²°μ κΈμ•΅μ„ μ „μ†΅ν•©λ‹λ‹¤.)

---

### 4. κΈ°μ  μ„¤κ³„ μ£Όμ” ν¬μΈνΈ

#### π¤ λ™μ‹μ„± μ μ–΄

- ν¬μΈνΈ μ°¨κ° μ‹ λ°μ΄ν„° μ •ν•©μ„±μ„ λ³΄μ¥ν•κΈ° μ„ν•΄ DB λ λ²¨ λ½ λλ” Redis κΈ°λ° λ¶„μ‚° λ½ μ‚¬μ©

#### π“ μΈκΈ° λ©”λ‰΄ μ§‘κ³„

- μ‹¤μ‹κ°„μΌλ΅ μ£Όλ¬Έ λ°μ΄ν„°λ¥Ό Redis Sorted Setμ— κΈ°λ΅
- λ°°μΉ λλ” μ΅°ν μ‹μ μ— 7μΌ μ΄λ‚΄ λ°μ΄ν„°λ¥Ό κΈ°μ¤€μΌλ΅ μ •λ ¬ ν›„ μƒμ„ 3κ° μ¶”μ¶

#### π“΅ μ‹¤μ‹κ°„ μ „μ†΅ λ΅μ§

- μ£Όλ¬Έ μ„±κ³µ μ‹ λΉ„λ™κΈ° λ°©μ‹ (Kafka or Async Queue)μΌλ΅ μ™Έλ¶€ API (Mock) μ „μ†΅
- μ‹¤ν¨ μ‹ μ¬μ‹λ„ νμ— μ €μ¥ν•μ—¬ μ¬μ „μ†΅ λ΅μ§ κµ¬ν„ (at-least-once λ³΄μ¥)

---

## λ§μΌμ¤ν†¤ (Milestones)

| issue id | κΈ°κ°„    | ν•­λ©                                       | μ„Έλ¶€ λ‚΄μ©                            |
| -------- | ------- | ------------------------------------------ | ------------------------------------ |
| cf-1     | 2μ‹κ°„   | μ”κµ¬μ‚¬ν•­ λ¶„μ„ λ° ν…ν¬ μ¤ν™ μ‘μ„±            | API μ„¤κ³„, erd μ„¤κ³„, ν•µμ‹¬ μ„λΉ„μ¤ μ„¤κ³„ |
| cf-2     | 1μ‹κ°„   | DB, Redis Docker μ„Έν…                      | κΈ°λ³Έ μΈν”„λΌ μ„Έν… + nest js bp ν™•μΈ   |
| cf-3     | 1.5μ‹κ°„ | TypeORM λ¨λΈ μ„Έν…                          | nest js bp ν™•μΈ                      |
| cf-4     | 0.5μ‹κ°„ | λ¨λ“  Route Swagger + Controller μ‘μ„±       | nest js bp ν™•μΈ                      |
| cf-5     | 0.5μ‹κ°„ | μ²« λ ν¬μ§€ν† λ¦¬ + μ„λΉ„μ¤ κµ¬ν„                | nest js bp ν™•μΈ                      |
| cf-6     | 0.5μ‹κ°„ | μ²« ν…μ¤ν… κµ¬ν„ + testable code κ³ λ―Ό        | nest js bp ν™•μΈ                      |
| cf-7     | 1.5μ‹κ°„ | λ‚λ¨Έμ§€ λ ν¬μ§€ν† λ¦¬ + μ„λΉ„μ¤ + ν…μ¤ν… λ§λ¬΄λ¦¬ | nest js bp ν™•μΈ                      |
| cf-8     | 0.5μ‹κ°„ | bp μ•λ§λ” λ¶€λ¶„ λ¦¬ν©ν† λ§                    | nest js bp ν™•μΈ                      |
| cf-9     | 0.5μ‹κ°„ | e2e happy path ν…μ¤ν… κµ¬ν„                 | nest js bp ν™•μΈ                      |
| cf-10    | 2μ‹κ°„   | νκ³  λ° nest js μ–΄λ ¤μ΄ λ¶€λ¶„ μ΄ν•΄           |                                      |
| cf-11    | 4μ‹κ°„   | (μ„ νƒ) nest js ν•µμ‹¬ κΈ°μ  λ”¥ λ‹¤μ΄λΈ         |                                      |

μ΄κ³„ 10.5 μ‹κ°„ + (μ„ νƒ 4μ‹κ°„)

---

## μ°Έκ³  μλ£

- [λ±…ν¬μƒλ¬λ“ ν…ν¬μ¤ν™ λ¬Έν™”](https://blog.banksalad.com/tech/we-work-by-tech-spec/)
- [Airbridge API κ°λ° ν”„λ΅μ„Έμ¤](https://engineering.ab180.co/stories/how-engineering-team-works-to-make-robust-product#2ff0f0e7-8c47-4ad8-9e2b-5635b7442d56)
